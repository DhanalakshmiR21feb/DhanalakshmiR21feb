{"ast":null,"code":"var _jsxFileName = \"E:\\\\workspace\\\\earnest-user\\\\frontend\\\\src\\\\components\\\\Login.js\";\nimport { LockOutlined, UserOutlined } from \"@ant-design/icons\";\nimport { Button, Input, message } from \"antd\";\nimport React from \"react\";\nimport { withRouter } from \"react-router-dom\";\nimport { config } from \"../App\";\nimport Footer from \"./Footer\";\nimport Header from \"./Header\";\n/**\n * @class Login component handles the Login page UI and functionality\n *\n * Contains the following fields\n *\n * @property {boolean} state.loading\n *    Indicates background action pending completion. When true, further UI actions might be blocked\n * @property {string}\n *    state.email User given field for user's email\n * @property {string}\n *    state.password User given field for password\n */\n\nclass Login extends React.Component {\n  constructor() {\n    super();\n\n    this.validateInput = () => {\n      if (!this.state.email) {\n        message.error(\"Email is a required field\");\n        return false;\n      }\n\n      if (!this.state.password) {\n        message.error(\"Password is a required field\");\n        return false;\n      }\n\n      return true;\n    };\n\n    this.validateResponse = (errored, response) => {\n      if (errored || !response.tokens && !response.message) {\n        message.error(\"Something went wrong. Check that the backend is running, reachable and returns valid JSON.\");\n        return false;\n      }\n\n      if (!response.tokens) {\n        message.error(response.message);\n        return false;\n      }\n\n      return true;\n    };\n\n    this.performAPICall = async () => {\n      let response = {};\n      let errored = false;\n      this.setState({\n        loading: true\n      });\n\n      try {\n        response = await (await fetch(`${config.endpoint}/auth/login`, {\n          method: \"POST\",\n          headers: {\n            \"Content-Type\": \"application/json\"\n          },\n          body: JSON.stringify({\n            email: this.state.email,\n            password: this.state.password\n          })\n        })).json();\n      } catch (e) {\n        errored = true;\n      }\n\n      this.setState({\n        loading: false\n      });\n\n      if (this.validateResponse(errored, response)) {\n        return response;\n      }\n    };\n\n    this.persistLogin = (token, email, balance, name, userId) => {\n      localStorage.setItem(\"token\", token);\n      localStorage.setItem(\"email\", email);\n      localStorage.setItem(\"balance\", balance);\n      localStorage.setItem(\"username\", name);\n      localStorage.setItem(\"userId\", userId);\n    };\n\n    this.login = async () => {\n      // if (this.validateInput()) {\n      const response = await this.performAPICall();\n\n      if (response) {\n        this.persistLogin(response.tokens.access.token, response.user.email, response.user.walletMoney, response.user.name, response.user._id);\n        this.setState({\n          email: \"\",\n          password: \"\"\n        });\n        message.success(\"Logged in successfully\");\n        this.props.history.push(\"/products\");\n      } // }\n\n    };\n\n    this.state = {\n      loading: false,\n      email: \"\",\n      password: \"\"\n    };\n  }\n  /**\n   * Validate the input values so that any bad or illegal values are not passed to the backend.\n   *\n   * @returns {boolean}\n   *    Whether validation has passed or not\n   *\n   * Return false if any validation condition fails, otherwise return true.\n   * -    Check that email field is not an empty value\n   * -    Check that password field is not an empty value\n   */\n\n\n  /**\n   * JSX and HTML goes here\n   * We have a text field and a password field (each with data binding to state), and a submit button that calls login()\n   */\n  render() {\n    return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Header, {\n      history: this.props.history,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 229,\n        columnNumber: 9\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"flex-container\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 232,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"login-container container\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 233,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"h1\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 234,\n        columnNumber: 13\n      }\n    }, \" \"), /*#__PURE__*/React.createElement(Input, {\n      className: \"input-field\",\n      prefix: /*#__PURE__*/React.createElement(UserOutlined, {\n        className: \"site-form-item-icon\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 238,\n          columnNumber: 23\n        }\n      }),\n      placeholder: \"email\",\n      onChange: e => {\n        this.setState({\n          email: e.target.value\n        });\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 236,\n        columnNumber: 13\n      }\n    }), /*#__PURE__*/React.createElement(Input.Password, {\n      className: \"input-field\",\n      prefix: /*#__PURE__*/React.createElement(LockOutlined, {\n        className: \"site-form-item-icon\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 249,\n          columnNumber: 23\n        }\n      }),\n      placeholder: \"Password\",\n      onChange: e => {\n        this.setState({\n          password: e.target.value\n        });\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 247,\n        columnNumber: 13\n      }\n    }), /*#__PURE__*/React.createElement(Button, {\n      loading: this.state.loading,\n      type: \"primary\",\n      onClick: this.login,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 258,\n        columnNumber: 13\n      }\n    }, \"Login\"))), /*#__PURE__*/React.createElement(Footer, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 269,\n        columnNumber: 9\n      }\n    }));\n  }\n\n} // export default Login;\n\n\nexport default withRouter(Login);","map":{"version":3,"names":["LockOutlined","UserOutlined","Button","Input","message","React","withRouter","config","Footer","Header","Login","Component","constructor","validateInput","state","email","error","password","validateResponse","errored","response","tokens","performAPICall","setState","loading","fetch","endpoint","method","headers","body","JSON","stringify","json","e","persistLogin","token","balance","name","userId","localStorage","setItem","login","access","user","walletMoney","_id","success","props","history","push","render","target","value"],"sources":["E:/workspace/earnest-user/frontend/src/components/Login.js"],"sourcesContent":["import { LockOutlined, UserOutlined } from \"@ant-design/icons\";\nimport { Button, Input, message } from \"antd\";\nimport React from \"react\";\nimport { withRouter } from \"react-router-dom\";\nimport { config } from \"../App\";\nimport Footer from \"./Footer\";\nimport Header from \"./Header\";\n\n/**\n * @class Login component handles the Login page UI and functionality\n *\n * Contains the following fields\n *\n * @property {boolean} state.loading\n *    Indicates background action pending completion. When true, further UI actions might be blocked\n * @property {string}\n *    state.email User given field for user's email\n * @property {string}\n *    state.password User given field for password\n */\nclass Login extends React.Component {\n  constructor() {\n    super();\n    this.state = {\n      loading: false,\n      email: \"\",\n      password: \"\",\n    };\n  }\n\n  /**\n   * Validate the input values so that any bad or illegal values are not passed to the backend.\n   *\n   * @returns {boolean}\n   *    Whether validation has passed or not\n   *\n   * Return false if any validation condition fails, otherwise return true.\n   * -    Check that email field is not an empty value\n   * -    Check that password field is not an empty value\n   */\n  validateInput = () => {\n    if (!this.state.email) {\n      message.error(\"Email is a required field\");\n      return false;\n    }\n    if (!this.state.password) {\n      message.error(\"Password is a required field\");\n      return false;\n    }\n    return true;\n  };\n\n  /**\n   * Check the response of the API call to be valid and handle any failures along the way\n   *\n   * @param {boolean} errored\n   *    Represents whether an error occurred in the process of making the API call itself\n   * @param {{ success: boolean, message?: string, token?: string, email?: string }} response\n   *    The response JSON object from API call which may contain further success or error messages\n   * @returns {boolean}\n   *    Whether validation has passed or not\n   *\n   * If the API call itself encounters an error, errored flag will be true.\n   * If the backend returns an error, then success field will be false and message field will have a string with error details to be displayed.\n   * When there is an error in the API call itself, display a generic error message and return false.\n   * When there is an error returned by backend, display the given message field and return false.\n   * When there is no error and API call is successful, return true.\n   */\n  validateResponse = (errored, response) => {\n    if (errored || (!response.tokens && !response.message)) {\n      message.error(\n        \"Something went wrong. Check that the backend is running, reachable and returns valid JSON.\"\n      );\n      return false;\n    }\n    if (!response.tokens) {\n      message.error(response.message);\n      return false;\n    }\n    return true;\n  };\n\n  /**\n   * Perform the API call over the network and return the response\n   *\n   * @returns {{ success: boolean, token: string, email: string, balance: number }|undefined}\n   *    The response JSON object\n   *\n   * -    Set the loading state variable to true\n   * -    Perform the API call via a fetch call: https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API\n   *      - The call must be made asynchronously using Promises or async/await\n   *      - The call must handle any errors thrown from the fetch call\n   *      - Parse the result as JSON\n   * -    Set the loading state variable to false once the call has completed\n   * -    Call the validateResponse(errored, response) function defined previously\n   * -    If response passes validation, return the response object\n   *\n   * Example for successful response from backend:\n   * HTTP 200\n   * {\n   * \"user\": {\n   *     \"walletMoney\": 500,\n   *     \"address\": \"\",\n   *     \"_id\": \"6005988f06ea6b360cb75747\",\n   *     \"name\": \"user-name\",\n   *     \"email\": \"user-email\",\n   *     \"password\": \"user-pass-enc,\n   *     \"createdAt\": \"timestamp\",\n   *     \"updatedAt\": \"timestamp\",\n   *     \"__v\": 0\n   * },\n   * \"tokens\": {\n   *     \"access\": {\n   *         \"token\": \"user-access-token\",\n   *         \"expires\": \"expity-timestamp\n   *     }\n   * }\n   * }\n   *\n   * Example for failed response from backend:\n   * HTTP 400\n   * {\n   *      \"code\": 400,\n   *      \"message\": \"email is required\"\n   * }\n   */\n  performAPICall = async () => {\n    let response = {};\n    let errored = false;\n    this.setState({\n      loading: true,\n    });\n    try {\n      response = await (\n        await fetch(`${config.endpoint}/auth/login`, {\n          method: \"POST\",\n          headers: {\n            \"Content-Type\": \"application/json\",\n          },\n          body: JSON.stringify({\n            email: this.state.email,\n            password: this.state.password,\n          }),\n        })\n      ).json();\n    } catch (e) {\n      errored = true;\n    }\n    this.setState({\n      loading: false,\n    });\n    if (this.validateResponse(errored, response)) {\n      return response;\n    }\n  };\n\n  /**\n   * Store the login information so that it can be used to identify the user in subsequent API calls\n   *\n   * @param {string} token\n   *    API token used for authentication of requests after logging in\n   * @param {string} email\n   *    Email of the logged in user\n   * @param {string} balance\n   *    Wallet balance amount of the logged in user\n   *\n   * Make use of localStorage: https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage\n   * -    `token` field in localStorage can be used to store the Oauth token\n   * -    `email` field in localStorage can be used to store the email that the user is logged in as\n   * -    `balance` field in localStorage can be used to store the balance amount in the user's wallet\n   * -    `username` field in localStorage can be used to store the User's name\n   * -    `userId` field in localStorage can be used to store the user ID\n   */\n  persistLogin = (token, email, balance, name, userId) => {\n    localStorage.setItem(\"token\", token);\n    localStorage.setItem(\"email\", email);\n    localStorage.setItem(\"balance\", balance);\n    localStorage.setItem(\"username\", name);\n    localStorage.setItem(\"userId\", userId);\n  };\n\n  /**\n   * Definition for login handler\n   * This is the function that is called when the user clicks on the login button or submits the login form\n   * -    Call the previously defined validateInput() function and check that is returns true, i.e. the input values pass validation\n   * -    Call the previously defined performAPICall() function asynchronously and capture the returned value in a variable\n   * -    If the returned value exists,\n   *      -   Call the previously defined persistLogin(token, email, balance,username,userId) function\n   *      -   Clear the input fields\n   *      -   Display a success message\n   *      -   Redirect the user to the \"/products\" page\n   */\n\n  /**\n   * Definition for login handler\n   * This is the function that is called when the user clicks on the login button or submits the login form\n   *    - Display a message, \"Login logic not implemented yet\"\n   */\n\n  login = async () => {\n    // if (this.validateInput()) {\n    const response = await this.performAPICall();\n    if (response) {\n      this.persistLogin(\n        response.tokens.access.token,\n        response.user.email,\n        response.user.walletMoney,\n        response.user.name,\n        response.user._id\n      );\n      this.setState({\n        email: \"\",\n        password: \"\",\n      });\n      message.success(\"Logged in successfully\");\n      this.props.history.push(\"/products\");\n    }\n    // }\n  };\n\n  /**\n   * JSX and HTML goes here\n   * We have a text field and a password field (each with data binding to state), and a submit button that calls login()\n   */\n  render() {\n    return (\n      <>\n        {/* Display Header */}\n        <Header history={this.props.history} />\n\n        {/* Display Login fields */}\n        <div className=\"flex-container\">\n          <div className=\"login-container container\">\n            <h1> </h1>\n\n            <Input\n              className=\"input-field\"\n              prefix={<UserOutlined className=\"site-form-item-icon\" />}\n              placeholder=\"email\"\n              onChange={(e) => {\n                this.setState({\n                  email: e.target.value,\n                });\n              }}\n            />\n\n            <Input.Password\n              className=\"input-field\"\n              prefix={<LockOutlined className=\"site-form-item-icon\" />}\n              placeholder=\"Password\"\n              onChange={(e) => {\n                this.setState({\n                  password: e.target.value,\n                });\n              }}\n            />\n\n            <Button\n              loading={this.state.loading}\n              type=\"primary\"\n              onClick={this.login}\n            >\n              Login\n            </Button>\n          </div>\n        </div>\n\n        {/* Display the footer */}\n        <Footer></Footer>\n      </>\n    );\n  }\n}\n\n// export default Login;\n\nexport default withRouter(Login);\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}